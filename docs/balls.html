<!DOCTYPE html>  <html> <head>   <title>balls.coffee</title>   <meta http-equiv="content-type" content="text/html; charset=UTF-8">   <link rel="stylesheet" media="all" href="docco.css" /> </head> <body>   <div id="container">     <div id="background"></div>          <table cellpadding="0" cellspacing="0">       <thead>         <tr>           <th class="docs">             <h1>               balls.coffee             </h1>           </th>           <th class="code">           </th>         </tr>       </thead>       <tbody>                               <tr id="section-1">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-1">&#182;</a>               </div>               <pre><code>Physics demo with bouncing balls.

(c) Johan Brook 2013. MIT Licensed.
http://johanbrook.com
http://github.com/johanbrook
</code></pre>

<p>Required Javascript APIs: <code>Canvas</code> and <code>requestAnimationFrame</code>.</p>             </td>             <td class="code">               <div class="highlight"><pre></pre></div>             </td>           </tr>                               <tr id="section-2">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-2">&#182;</a>               </div>               <h1>Setup</h1>             </td>             <td class="code">               <div class="highlight"><pre></pre></div>             </td>           </tr>                               <tr id="section-3">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-3">&#182;</a>               </div>               <p>Set some config variables for our scenario.</p>             </td>             <td class="code">               <div class="highlight"><pre><span class="nv">config = </span>
  <span class="nv">gravity: </span> <span class="mf">9.82</span>
  <span class="nv">fps: </span>   <span class="mi">60</span>
  <span class="nv">number_of_balls: </span><span class="mi">2</span></pre></div>             </td>           </tr>                               <tr id="section-4">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-4">&#182;</a>               </div>               <p>When the document has loaded, create a new animator from a graphics
context and some balls.</p>             </td>             <td class="code">               <div class="highlight"><pre><span class="nb">document</span><span class="p">.</span><span class="nx">addEventListener</span> <span class="s">&#39;DOMContentLoaded&#39;</span><span class="p">,</span> <span class="nf">(evt) -&gt;</span>
  <span class="nv">context = </span><span class="nb">document</span><span class="p">.</span><span class="nx">getElementById</span><span class="p">(</span><span class="s">&quot;canvas&quot;</span><span class="p">)</span>
  <span class="nv">balls = </span><span class="nx">create_balls</span><span class="p">(</span><span class="nx">config</span><span class="p">.</span><span class="nx">number_of_balls</span><span class="p">)</span>

  <span class="nv">animator = </span><span class="k">new</span> <span class="nx">Animator</span><span class="p">(</span><span class="nx">context</span><span class="p">,</span> <span class="nx">balls</span><span class="p">)</span></pre></div>             </td>           </tr>                               <tr id="section-5">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-5">&#182;</a>               </div>               <p>Run the animation</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="nx">animator</span><span class="p">.</span><span class="nx">go</span><span class="p">()</span></pre></div>             </td>           </tr>                               <tr id="section-6">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-6">&#182;</a>               </div>               <h1>Classes</h1>             </td>             <td class="code">               <div class="highlight"><pre></pre></div>             </td>           </tr>                               <tr id="section-7">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-7">&#182;</a>               </div>               <h2>Helpers</h2>             </td>             <td class="code">               <div class="highlight"><pre></pre></div>             </td>           </tr>                               <tr id="section-8">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-8">&#182;</a>               </div>               <p>Define helper classes for polar points and regular points with
Cartesian coordinates.</p>             </td>             <td class="code">               <div class="highlight"><pre><span class="k">class</span> <span class="nx">PolarPoint</span>
  <span class="nv">constructor: </span><span class="nf">(@len, @angle) -&gt;</span>

<span class="k">class</span> <span class="nx">Point</span>
  <span class="nv">constructor: </span><span class="nf">(@x, @y) -&gt;</span></pre></div>             </td>           </tr>                               <tr id="section-9">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-9">&#182;</a>               </div>               <h2>The Animator class</h2>             </td>             <td class="code">               <div class="highlight"><pre></pre></div>             </td>           </tr>                               <tr id="section-10">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-10">&#182;</a>               </div>               <p>The animator class is responsible for the scene, i.e. drawing and updating
positions of the objects. Uses <code>window.requestAnimationFrame</code> for animation.</p>             </td>             <td class="code">               <div class="highlight"><pre><span class="k">class</span> <span class="nx">Animator</span></pre></div>             </td>           </tr>                               <tr id="section-11">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-11">&#182;</a>               </div>               <p>Create a new animation on a <code>&lt;canvas&gt;</code> element and from an
array of preconstruted balls.</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="nv">constructor: </span><span class="nf">(canvas, @balls) -&gt;</span>
    <span class="vi">@canvas = </span><span class="nx">canvas</span><span class="p">.</span><span class="nx">getContext</span><span class="p">(</span><span class="s">&quot;2d&quot;</span><span class="p">)</span></pre></div>             </td>           </tr>                               <tr id="section-12">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-12">&#182;</a>               </div>               <p>Set the update interval according to the desired FPS.</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="vi">@interval = </span><span class="mi">1000</span> <span class="o">/</span> <span class="nx">config</span><span class="p">.</span><span class="nx">fps</span>
    <span class="p">[</span><span class="nx">@width</span><span class="p">,</span> <span class="nx">@height</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="nx">canvas</span><span class="p">.</span><span class="nx">width</span><span class="p">,</span> <span class="nx">canvas</span><span class="p">.</span><span class="nx">height</span><span class="p">]</span></pre></div>             </td>           </tr>                               <tr id="section-13">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-13">&#182;</a>               </div>               <p>Start the animation. </p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="nv">go: </span><span class="o">=&gt;</span></pre></div>             </td>           </tr>                               <tr id="section-14">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-14">&#182;</a>               </div>               <p>Request a frame, with <code>go</code> as its own callback.</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="nb">window</span><span class="p">.</span><span class="nx">requestAnimationFrame</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">go</span><span class="p">)</span></pre></div>             </td>           </tr>                               <tr id="section-15">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-15">&#182;</a>               </div>               <p>Update all movements for a delta time and redraw all
objects on the canvas according to the newly updated movements.</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="k">this</span><span class="p">.</span><span class="nx">tick</span><span class="p">(</span><span class="mi">1</span><span class="o">/</span><span class="nx">@interval</span><span class="p">)</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">draw</span><span class="p">()</span></pre></div>             </td>           </tr>                               <tr id="section-16">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-16">&#182;</a>               </div>               <p>The draw method redraws each element in <code>@balls</code>. </p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="nv">draw: </span><span class="o">-&gt;</span>
    <span class="nx">@canvas</span><span class="p">.</span><span class="nx">clearRect</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="nx">@width</span><span class="p">,</span> <span class="nx">@height</span>

    <span class="k">for</span> <span class="nx">ball</span> <span class="k">in</span> <span class="nx">@balls</span>
      <span class="nx">@canvas</span><span class="p">.</span><span class="nx">beginPath</span><span class="p">()</span>
      <span class="vi">@canvas.fillStyle = </span><span class="nx">ball</span><span class="p">.</span><span class="nx">color</span>
      <span class="nx">@canvas</span><span class="p">.</span><span class="nx">arc</span><span class="p">(</span><span class="nx">ball</span><span class="p">.</span><span class="nx">x</span><span class="p">,</span> <span class="nx">ball</span><span class="p">.</span><span class="nx">y</span><span class="p">,</span> <span class="nx">ball</span><span class="p">.</span><span class="nx">r</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="nb">Math</span><span class="p">.</span><span class="nx">PI</span><span class="o">*</span><span class="mi">2</span><span class="p">,</span> <span class="kc">true</span><span class="p">)</span>
      <span class="nx">@canvas</span><span class="p">.</span><span class="nx">closePath</span><span class="p">()</span>
      <span class="nx">@canvas</span><span class="p">.</span><span class="nx">fill</span><span class="p">()</span></pre></div>             </td>           </tr>                               <tr id="section-17">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-17">&#182;</a>               </div>               <p>For each tick, update the movements of the objects.</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="nv">tick: </span><span class="nf">(dt) -&gt;</span>

    <span class="k">for</span> <span class="nx">ball</span> <span class="k">in</span> <span class="nx">@balls</span></pre></div>             </td>           </tr>                               <tr id="section-18">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-18">&#182;</a>               </div>               <p>Firstly, update the ball's vertical gravity by setting a new
vertical velocity from the gravity config variable.</p>             </td>             <td class="code">               <div class="highlight"><pre>      <span class="nv">ball.vy = </span><span class="nx">ball</span><span class="p">.</span><span class="nx">vy</span> <span class="o">+</span> <span class="nx">config</span><span class="p">.</span><span class="nx">gravity</span> <span class="o">*</span> <span class="nx">dt</span></pre></div>             </td>           </tr>                               <tr id="section-19">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-19">&#182;</a>               </div>               <h3>Wall collisions</h3>             </td>             <td class="code">               <div class="highlight"><pre></pre></div>             </td>           </tr>                               <tr id="section-20">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-20">&#182;</a>               </div>               <p>In order to check for collisions, we need to clone the ball object
and then move it one frame ahead, and then use it to foresee a collision.
We do this to avoid real-time glitches when two object collide.</p>             </td>             <td class="code">               <div class="highlight"><pre>      <span class="nv">ghost_ball = </span><span class="nx">ball</span><span class="p">.</span><span class="nx">clone</span><span class="p">()</span>
      <span class="nx">ghost_ball</span><span class="p">.</span><span class="nx">move</span><span class="p">(</span><span class="nx">dt</span><span class="p">)</span></pre></div>             </td>           </tr>                               <tr id="section-21">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-21">&#182;</a>               </div>               <p>Check for collisions with walls. If the ball is colliding, reverse
the horizontal and vertical velocities.</p>             </td>             <td class="code">               <div class="highlight"><pre>      <span class="k">if</span> <span class="nx">ghost_ball</span><span class="p">.</span><span class="nx">x</span> <span class="o">&lt;</span> <span class="nx">ghost_ball</span><span class="p">.</span><span class="nx">r</span> <span class="o">or</span> <span class="nx">ghost_ball</span><span class="p">.</span><span class="nx">x</span> <span class="o">&gt;</span> <span class="nx">@width</span> <span class="o">-</span> <span class="nx">ghost_ball</span><span class="p">.</span><span class="nx">r</span>
        <span class="nv">ball.vx = </span><span class="nx">ball</span><span class="p">.</span><span class="nx">vx</span> <span class="o">*</span> <span class="o">-</span><span class="mi">1</span>

      <span class="k">if</span> <span class="nx">ghost_ball</span><span class="p">.</span><span class="nx">y</span> <span class="o">&lt;</span> <span class="nx">ghost_ball</span><span class="p">.</span><span class="nx">r</span> <span class="o">or</span> <span class="nx">ghost_ball</span><span class="p">.</span><span class="nx">y</span> <span class="o">&gt;</span> <span class="nx">@height</span> <span class="o">-</span> <span class="nx">ghost_ball</span><span class="p">.</span><span class="nx">r</span>
        <span class="nv">ball.vy = </span><span class="nx">ball</span><span class="p">.</span><span class="nx">vy</span> <span class="o">*</span> <span class="o">-</span><span class="mi">1</span></pre></div>             </td>           </tr>                               <tr id="section-22">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-22">&#182;</a>               </div>               <h3>Ball collisions</h3>             </td>             <td class="code">               <div class="highlight"><pre>      <span class="k">for</span> <span class="nx">other_ball</span> <span class="k">in</span> <span class="nx">@balls</span></pre></div>             </td>           </tr>                               <tr id="section-23">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-23">&#182;</a>               </div>               <p>Again, we're cloning the ball to check for a collision with
another ball.</p>             </td>             <td class="code">               <div class="highlight"><pre>        <span class="nv">ghost_ball = </span><span class="nx">ball</span><span class="p">.</span><span class="nx">clone</span><span class="p">()</span>
        <span class="nx">ghost_ball</span><span class="p">.</span><span class="nx">move</span><span class="p">(</span><span class="nx">dt</span><span class="p">)</span>
        </pre></div>             </td>           </tr>                               <tr id="section-24">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-24">&#182;</a>               </div>               <p>Make sure it's not the same ball. Then see if there's a collision (overlap).</p>             </td>             <td class="code">               <div class="highlight"><pre>        <span class="k">if</span> <span class="nx">ball</span><span class="p">.</span><span class="nx">id</span> <span class="o">isnt</span> <span class="nx">other_ball</span><span class="p">.</span><span class="nx">id</span> <span class="o">and</span> <span class="nx">ghost_ball</span><span class="p">.</span><span class="nx">is_colliding_with</span> <span class="nx">other_ball</span></pre></div>             </td>           </tr>                               <tr id="section-25">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-25">&#182;</a>               </div>               <p>First calculate the collision angle from the balls coordinates.</p>             </td>             <td class="code">               <div class="highlight"><pre>          <span class="nv">alpha = </span><span class="nb">Math</span><span class="p">.</span><span class="nx">atan2</span> <span class="nx">ball</span><span class="p">.</span><span class="nx">y</span> <span class="o">-</span> <span class="nx">other_ball</span><span class="p">.</span><span class="nx">y</span><span class="p">,</span> <span class="nx">ball</span><span class="p">.</span><span class="nx">x</span> <span class="o">-</span> <span class="nx">other_ball</span><span class="p">.</span><span class="nx">x</span>
          </pre></div>             </td>           </tr>                               <tr id="section-26">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-26">&#182;</a>               </div>               <p>Get the total velocity and direction for the balls,
i.e. the polar coordinate components length and angle.</p>             </td>             <td class="code">               <div class="highlight"><pre>          <span class="nv">pp1 = </span><span class="nx">ball</span><span class="p">.</span><span class="nx">to_polar_point</span><span class="p">()</span>
          <span class="nv">pp2 = </span><span class="nx">other_ball</span><span class="p">.</span><span class="nx">to_polar_point</span><span class="p">()</span>
          
          <span class="p">[</span><span class="nx">u1</span><span class="p">,</span> <span class="nx">u2</span><span class="p">,</span> <span class="nx">d1</span><span class="p">,</span> <span class="nx">d2</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="nx">pp1</span><span class="p">.</span><span class="nx">len</span><span class="p">,</span> <span class="nx">pp2</span><span class="p">.</span><span class="nx">len</span><span class="p">,</span> <span class="nx">pp1</span><span class="p">.</span><span class="nx">angle</span><span class="p">,</span> <span class="nx">pp2</span><span class="p">.</span><span class="nx">angle</span><span class="p">]</span>
          </pre></div>             </td>           </tr>                               <tr id="section-27">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-27">&#182;</a>               </div>               <p>Compute new coordinate system from the magnitude
and direction/collision angle of the balls.</p>             </td>             <td class="code">               <div class="highlight"><pre>          <span class="p">[</span><span class="nx">p1</span><span class="p">,</span> <span class="nx">p2</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="nx">polar_to_rect</span><span class="p">(</span><span class="nx">u1</span><span class="p">,</span> <span class="nx">d1</span><span class="o">-</span><span class="nx">alpha</span><span class="p">),</span> <span class="nx">polar_to_rect</span><span class="p">(</span><span class="nx">u2</span><span class="p">,</span> <span class="nx">d2</span><span class="o">-</span><span class="nx">alpha</span><span class="p">)]</span>

          <span class="p">[</span><span class="nx">u1x</span><span class="p">,</span> <span class="nx">u1y</span><span class="p">,</span> <span class="nx">u2x</span><span class="p">,</span> <span class="nx">u2y</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="nx">p1</span><span class="p">.</span><span class="nx">x</span><span class="p">,</span> <span class="nx">p1</span><span class="p">.</span><span class="nx">y</span><span class="p">,</span> <span class="nx">p2</span><span class="p">.</span><span class="nx">x</span><span class="p">,</span> <span class="nx">p2</span><span class="p">.</span><span class="nx">y</span><span class="p">]</span>
          </pre></div>             </td>           </tr>                               <tr id="section-28">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-28">&#182;</a>               </div>               <p>Now we are in the new coordinate system where the collision
will behave as in 1D, i.e. the balls are colliding in front
of each other (their direction is the normal line between them).</p>             </td>             <td class="code">               <div class="highlight"><pre>          </pre></div>             </td>           </tr>                               <tr id="section-29">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-29">&#182;</a>               </div>               <p>Solve the velocities along the new x-axis. This is done according to the
formula for preserving kinetic energy for two objects.</p>

<pre><code>m1 v1^2  +  m2 v2^2   =   m1 u1^2  +  m2 u2^2
-------     -------       -------     -------
    2           2             2           2
</code></pre>

<p><a href="http://www.cse.chalmers.se/edu/year/2010/course/DAT026/CourseMaterial/lecture5.txt">More info about the underlying physics computations</a>.</p>             </td>             <td class="code">               <div class="highlight"><pre>          <span class="nv">v1x = </span><span class="p">(</span><span class="nx">u1x</span><span class="o">*</span><span class="p">(</span><span class="nx">ball</span><span class="p">.</span><span class="nx">w</span><span class="o">-</span><span class="nx">other_ball</span><span class="p">.</span><span class="nx">w</span><span class="p">)</span> <span class="o">+</span> <span class="mi">2</span><span class="o">*</span><span class="nx">other_ball</span><span class="p">.</span><span class="nx">w</span><span class="o">*</span><span class="nx">u2x</span><span class="p">)</span> <span class="o">/</span> <span class="p">(</span><span class="nx">ball</span><span class="p">.</span><span class="nx">w</span><span class="o">+</span><span class="nx">other_ball</span><span class="p">.</span><span class="nx">w</span><span class="p">)</span>
          <span class="nv">v2x = </span><span class="p">(</span><span class="nx">u2x</span><span class="o">*</span><span class="p">(</span><span class="nx">other_ball</span><span class="p">.</span><span class="nx">w</span><span class="o">-</span><span class="nx">ball</span><span class="p">.</span><span class="nx">w</span><span class="p">)</span> <span class="o">+</span> <span class="mi">2</span><span class="o">*</span><span class="nx">ball</span><span class="p">.</span><span class="nx">w</span><span class="o">*</span><span class="nx">u1x</span><span class="p">)</span> <span class="o">/</span> <span class="p">(</span><span class="nx">ball</span><span class="p">.</span><span class="nx">w</span><span class="o">+</span><span class="nx">other_ball</span><span class="p">.</span><span class="nx">w</span><span class="p">)</span>
          </pre></div>             </td>           </tr>                               <tr id="section-30">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-30">&#182;</a>               </div>               <p>The velocities along the y-axis are unchanged.</p>             </td>             <td class="code">               <div class="highlight"><pre>          <span class="nv">v1y = </span><span class="nx">u1y</span>
          <span class="nv">v2y = </span><span class="nx">u2y</span></pre></div>             </td>           </tr>                               <tr id="section-31">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-31">&#182;</a>               </div>               <p>Convert back to Cartesian coords. PI / 2 is for shifting the direction
90 degrees, since the X and Y axis are perpendicular. </p>             </td>             <td class="code">               <div class="highlight"><pre>          <span class="nv">ball.vx = </span><span class="nb">Math</span><span class="p">.</span><span class="nx">cos</span><span class="p">(</span><span class="nx">alpha</span><span class="p">)</span> <span class="o">*</span> <span class="nx">v1x</span> <span class="o">+</span> <span class="nb">Math</span><span class="p">.</span><span class="nx">cos</span><span class="p">(</span><span class="nx">alpha</span> <span class="o">+</span> <span class="nb">Math</span><span class="p">.</span><span class="nx">PI</span> <span class="o">/</span> <span class="mi">2</span><span class="p">)</span> <span class="o">*</span> <span class="nx">v1y</span>
          <span class="nv">ball.vy = </span><span class="nb">Math</span><span class="p">.</span><span class="nx">sin</span><span class="p">(</span><span class="nx">alpha</span><span class="p">)</span> <span class="o">*</span> <span class="nx">v1x</span> <span class="o">+</span> <span class="nb">Math</span><span class="p">.</span><span class="nx">sin</span><span class="p">(</span><span class="nx">alpha</span> <span class="o">+</span> <span class="nb">Math</span><span class="p">.</span><span class="nx">PI</span> <span class="o">/</span> <span class="mi">2</span><span class="p">)</span> <span class="o">*</span> <span class="nx">v1y</span>
          
          <span class="nv">other_ball.vx = </span><span class="nb">Math</span><span class="p">.</span><span class="nx">cos</span><span class="p">(</span><span class="nx">alpha</span><span class="p">)</span> <span class="o">*</span> <span class="nx">v2x</span> <span class="o">+</span> <span class="nb">Math</span><span class="p">.</span><span class="nx">cos</span><span class="p">(</span><span class="nx">alpha</span> <span class="o">+</span> <span class="nb">Math</span><span class="p">.</span><span class="nx">PI</span> <span class="o">/</span> <span class="mi">2</span><span class="p">)</span> <span class="o">*</span> <span class="nx">v2y</span>
          <span class="nv">other_ball.vy = </span><span class="nb">Math</span><span class="p">.</span><span class="nx">sin</span><span class="p">(</span><span class="nx">alpha</span><span class="p">)</span> <span class="o">*</span> <span class="nx">v2x</span> <span class="o">+</span> <span class="nb">Math</span><span class="p">.</span><span class="nx">sin</span><span class="p">(</span><span class="nx">alpha</span> <span class="o">+</span> <span class="nb">Math</span><span class="p">.</span><span class="nx">PI</span> <span class="o">/</span> <span class="mi">2</span><span class="p">)</span> <span class="o">*</span> <span class="nx">v2y</span></pre></div>             </td>           </tr>                               <tr id="section-32">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-32">&#182;</a>               </div>               <p>Lastly, move the ball. This will update it's coordinates according 
to the newly set velocities.</p>             </td>             <td class="code">               <div class="highlight"><pre>      <span class="nx">ball</span><span class="p">.</span><span class="nx">move</span><span class="p">(</span><span class="nx">dt</span><span class="p">)</span></pre></div>             </td>           </tr>                               <tr id="section-33">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-33">&#182;</a>               </div>               <h2>The Ball class</h2>             </td>             <td class="code">               <div class="highlight"><pre></pre></div>             </td>           </tr>                               <tr id="section-34">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-34">&#182;</a>               </div>               <p>This class models a single ball with properties like coordinates,
velocities, weight, radius and color.</p>             </td>             <td class="code">               <div class="highlight"><pre><span class="k">class</span> <span class="nx">Ball</span> 

  <span class="nv">constructor: </span><span class="nf">(params) -&gt;</span>
    <span class="p">[</span><span class="nx">@x</span><span class="p">,</span> <span class="nx">@y</span><span class="p">,</span> <span class="nx">@r</span><span class="p">,</span> <span class="nx">@w</span><span class="p">,</span> <span class="nx">@color</span><span class="p">,</span> <span class="nx">@vx</span><span class="p">,</span> <span class="nx">@vy</span><span class="p">]</span> <span class="o">=</span> 
    <span class="p">[</span><span class="nx">params</span><span class="p">.</span><span class="nx">x</span><span class="p">,</span> <span class="nx">params</span><span class="p">.</span><span class="nx">y</span><span class="p">,</span> <span class="nx">params</span><span class="p">.</span><span class="nx">r</span><span class="p">,</span> <span class="nx">params</span><span class="p">.</span><span class="nx">w</span><span class="p">,</span> <span class="nx">params</span><span class="p">.</span><span class="nx">color</span> <span class="o">or</span> <span class="s">&#39;red&#39;</span><span class="p">,</span> <span class="nx">params</span><span class="p">.</span><span class="nx">vx</span> <span class="o">or</span> <span class="mi">0</span><span class="p">,</span> <span class="nx">params</span><span class="p">.</span><span class="nx">vy</span> <span class="o">or</span> <span class="mi">0</span><span class="p">]</span></pre></div>             </td>           </tr>                               <tr id="section-35">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-35">&#182;</a>               </div>               <p>Set a unique id on this ball instance.</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="vi">@id = </span><span class="nx">guid</span><span class="p">()</span></pre></div>             </td>           </tr>                               <tr id="section-36">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-36">&#182;</a>               </div>               <p>A method for cloning this ball object.</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="nv">clone: </span><span class="o">-&gt;</span>
    <span class="k">new</span> <span class="nx">Ball</span><span class="p">(</span> <span class="nv">x: </span><span class="nx">@x</span><span class="p">,</span> <span class="nv">y: </span><span class="nx">@y</span><span class="p">,</span> <span class="nv">r: </span><span class="nx">@r</span><span class="p">,</span> <span class="nv">w: </span><span class="nx">@w</span><span class="p">,</span> <span class="nv">color: </span><span class="nx">@color</span><span class="p">,</span> <span class="nv">vx: </span><span class="nx">@vx</span><span class="p">,</span> <span class="nv">vy: </span><span class="nx">@vy</span> <span class="p">)</span></pre></div>             </td>           </tr>                               <tr id="section-37">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-37">&#182;</a>               </div>               <p>Returns the velocity of this ball (basically the hypotenuse).</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="nv">get_velocity: </span><span class="o">-&gt;</span>
    <span class="nb">Math</span><span class="p">.</span><span class="nx">sqrt</span> <span class="nx">@vx</span><span class="o">*</span><span class="nx">@vx</span> <span class="o">+</span> <span class="nx">@vy</span><span class="o">*</span><span class="nx">@vy</span></pre></div>             </td>           </tr>                               <tr id="section-38">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-38">&#182;</a>               </div>               <p>Returns the direction of this ball.</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="nv">get_direction: </span><span class="o">-&gt;</span>
    <span class="nb">Math</span><span class="p">.</span><span class="nx">atan2</span> <span class="nx">@vy</span><span class="p">,</span> <span class="nx">@vx</span></pre></div>             </td>           </tr>                               <tr id="section-39">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-39">&#182;</a>               </div>               <p>Convert this ball's coordinates to polar coordinates, returns a <code>PolarPoint</code>. </p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="nv">to_polar_point: </span><span class="o">-&gt;</span>
    <span class="k">new</span> <span class="nx">PolarPoint</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">get_velocity</span><span class="p">(),</span> <span class="k">this</span><span class="p">.</span><span class="nx">get_direction</span><span class="p">())</span></pre></div>             </td>           </tr>                               <tr id="section-40">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-40">&#182;</a>               </div>               <p>Move this ball according to its velocity and delta time. This will update
the ball's coordinates.</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="nv">move: </span><span class="nf">(dt) -&gt;</span>
    <span class="nx">@x</span> <span class="o">+=</span> <span class="nx">@vx</span> <span class="o">*</span> <span class="nx">dt</span>
    <span class="nx">@y</span> <span class="o">+=</span> <span class="nx">@vy</span> <span class="o">*</span> <span class="nx">dt</span></pre></div>             </td>           </tr>                               <tr id="section-41">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-41">&#182;</a>               </div>               <p>Check to see if this ball collides (overlaps) with <code>other_ball</code>. Returns
<code>true</code> on collision, <code>false</code> otherwise. </p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="nv">is_colliding_with: </span><span class="nf">(other_ball) -&gt;</span></pre></div>             </td>           </tr>                               <tr id="section-42">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-42">&#182;</a>               </div>               <p>If the sum of the squares of the difference in coordinates are
less that the square of the sums of the radii, the balls are colliding.</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="nv">dx = </span><span class="nx">@x</span> <span class="o">-</span> <span class="nx">other_ball</span><span class="p">.</span><span class="nx">x</span>
    <span class="nv">dy = </span><span class="nx">@y</span> <span class="o">-</span> <span class="nx">other_ball</span><span class="p">.</span><span class="nx">y</span>
    <span class="nv">r = </span><span class="nx">@r</span> <span class="o">+</span> <span class="nx">other_ball</span><span class="p">.</span><span class="nx">r</span>

    <span class="nx">dx</span><span class="o">*</span><span class="nx">dx</span> <span class="o">+</span> <span class="nx">dy</span><span class="o">*</span><span class="nx">dy</span> <span class="o">&lt;</span> <span class="nx">r</span><span class="o">*</span><span class="nx">r</span></pre></div>             </td>           </tr>                               <tr id="section-43">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-43">&#182;</a>               </div>               <h1>Functions</h1>             </td>             <td class="code">               <div class="highlight"><pre></pre></div>             </td>           </tr>                               <tr id="section-44">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-44">&#182;</a>               </div>               <p>Helper function to create a given number of balls.</p>             </td>             <td class="code">               <div class="highlight"><pre><span class="nv">create_balls = </span><span class="nf">(amount) -&gt;</span>
  <span class="k">new</span> <span class="nx">Ball</span><span class="p">(</span> <span class="nv">x: </span><span class="nx">num</span><span class="o">*</span><span class="mi">60</span><span class="p">,</span> <span class="nv">y: </span><span class="mi">40</span><span class="p">,</span> <span class="nv">r: </span><span class="nx">num</span><span class="o">*</span><span class="mi">20</span><span class="p">,</span> <span class="nv">w: </span><span class="nx">num</span><span class="o">*</span><span class="mi">10</span><span class="p">,</span> <span class="nv">vx: </span><span class="mi">10</span><span class="o">*</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="o">*</span><span class="nx">num</span><span class="p">))</span> <span class="k">for</span> <span class="nx">num</span> <span class="k">in</span> <span class="p">[</span><span class="mi">1</span><span class="p">..</span><span class="nx">amount</span><span class="p">]</span></pre></div>             </td>           </tr>                               <tr id="section-45">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-45">&#182;</a>               </div>               <p>Helper function to convert polar coordinates to Cartesian coordinates. Returns a Point object.</p>             </td>             <td class="code">               <div class="highlight"><pre><span class="nv">polar_to_rect = </span><span class="nf">(len, degrees) -&gt;</span>
  <span class="nv">x = </span><span class="nx">len</span> <span class="o">*</span> <span class="nb">Math</span><span class="p">.</span><span class="nx">cos</span> <span class="nx">degrees</span>
  <span class="nv">y = </span><span class="nx">len</span> <span class="o">*</span> <span class="nb">Math</span><span class="p">.</span><span class="nx">sin</span> <span class="nx">degrees</span>
    
  <span class="k">new</span> <span class="nx">Point</span><span class="p">(</span><span class="nx">x</span><span class="p">,</span> <span class="nx">y</span><span class="p">)</span></pre></div>             </td>           </tr>                               <tr id="section-46">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-46">&#182;</a>               </div>               <p>Generate a randomized string.</p>             </td>             <td class="code">               <div class="highlight"><pre><span class="nv">s4 = </span><span class="o">-&gt;</span>
  <span class="nb">Math</span><span class="p">.</span><span class="nx">floor</span><span class="p">((</span><span class="mi">1</span> <span class="o">+</span> <span class="nb">Math</span><span class="p">.</span><span class="nx">random</span><span class="p">())</span> <span class="o">*</span> <span class="mh">0x10000</span><span class="p">).</span><span class="nx">toString</span><span class="p">(</span><span class="mi">16</span><span class="p">).</span><span class="nx">substring</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span></pre></div>             </td>           </tr>                               <tr id="section-47">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-47">&#182;</a>               </div>               <p>Generate a unique GUID.</p>             </td>             <td class="code">               <div class="highlight"><pre><span class="nv">guid = </span><span class="o">-&gt;</span>
  <span class="nx">s4</span><span class="p">()</span> <span class="o">+</span> <span class="nx">s4</span><span class="p">()</span> <span class="o">+</span> <span class="s">&#39;-&#39;</span> <span class="o">+</span> <span class="nx">s4</span><span class="p">()</span> <span class="o">+</span> <span class="s">&#39;-&#39;</span> <span class="o">+</span> <span class="nx">s4</span><span class="p">()</span> <span class="o">+</span> <span class="s">&#39;-&#39;</span> <span class="o">+</span> <span class="nx">s4</span><span class="p">()</span> <span class="o">+</span> <span class="s">&#39;-&#39;</span> <span class="o">+</span> <span class="nx">s4</span><span class="p">()</span> <span class="o">+</span> <span class="nx">s4</span><span class="p">()</span> <span class="o">+</span> <span class="nx">s4</span><span class="p">()</span>

</pre></div>             </td>           </tr>                </tbody>     </table>   </div> </body> </html> 